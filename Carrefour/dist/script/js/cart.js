!function(i){i.cookie("username")&&(i(".not-logged-in").hide(),i(".logged_in").show().find(".loginName").html(i.cookie("username"))),i(".logout").on("click",function(){i.cookie("username",null,{expires:-1}),i(".logged_in").hide(),i(".not-logged-in").show()})}(jQuery),function(a){function c(){a.cookie("cartsid")?(a(".cart-empty").hide(),a(".cart-filled").show()):(a(".cart-empty").show(),a(".cart-filled").hide())}c();var o=[],l=[];function t(){o=a.cookie("cartsid").split(","),l=a.cookie("cartnum").split(",")}function d(){var i=0,n=0;a(".goodsInfo:visible").each(function(){a(this).find("input:checkbox").is(":checked")&&(i+=parseFloat(a(this).find(".li04 span").html()),n+=parseFloat(a(this).find(".li03 .number-input").val()))}),a(".total-info .totalPrice strong").html("￥"+i.toFixed(2)),a(".total-info .goodsNumber").html(n),a(".total-info .big-total-price strong").html("￥"+i.toFixed(2))}a.cookie("cartsid")&&a.cookie("cartnum")&&(t(),a.each(o,function(i,n){var e,s;e=n,s=l[i],a.ajax({url:"../../php/detailsData.php",dataType:"json",data:{sid:e}}).done(function(i){var n=a(".goodsInfo:hidden").clone(!0),o=i.url.split(",");n.find(".li01").find("img").attr({src:o[0],sid:e}),n.find(".li01").find(".goodstitle span").html(i.title),n.find(".li01").find("a").attr("href","details.html?sid="+e),n.find(".li02").find("span").html(i.price),n.find(".li03").find(".number-input").val(s);var t=parseFloat(i.price.slice(1));n.find(".li04").find("span").html((t*s).toFixed(2)),n.show(),a(".goodsInfoUl").append(n),c(),d()})})),a(".all-select").on("change",function(){a(".goodsInfo:visible").find("input:checkbox").prop("checked",a(this).prop("checked")),a(".all-select").prop("checked",a(this).prop("checked")),d()});var i=a(".goodsInfo:visible").find("input:checkbox");function n(i){return(parseFloat(i.parents(".goodsInfo").find(".li02 span").html().slice(1))*parseInt(i.parents(".goodsInfo").find(".number-input").val())).toFixed(2)}function e(i){t();var n=i.parents(".goodsInfo").find("img").attr("sid");l[a.inArray(n,o)]=i.parents(".goodsInfo").find(".number-input").val(),a.cookie("cartnum",l.toString(),{expires:7})}function s(o,i){var t=-1;a.each(i,function(i,n){o==n&&(t=i)}),i.splice(t,1),l.splice(t,1),a.cookie("cartsid",i.toString(),{expires:7}),a.cookie("cartnum",l.toString(),{expires:7})}a(".goodsInfo").on("change",i,function(){var i=a(".goodsInfo:visible").find("input:checkbox");a(".goodsInfo:visible").find("input:checked").length==i.size()?a(".all-select").prop("checked",!0):a(".all-select").prop("checked",!1),d()}),a(".number-plus").on("click",function(){var i=a(this).parents(".goodsInfo").find(".number-input").val();99<++i&&(i=99),a(this).parents(".goodsInfo").find(".number-input").val(i),a(this).parents(".goodsInfo").find(".li04 span").html(n(a(this))),d(),e(a(this))}),a(".number-minus").on("click",function(){var i=a(this).parents(".goodsInfo").find(".number-input").val();--i<1&&(i=1),a(this).parents(".goodsInfo").find(".number-input").val(i),a(this).parents(".goodsInfo").find(".li04 span").html(n(a(this))),d(),e(a(this))}),a(".number-input").on("input",function(){var i=a(this).val();/^[\d]+$/.test(i)?99<i?a(this).val(99):i<1&&a(this).val(0):a(this).val(1),a(this).parents(".goodsInfo").find(".li04 span").html(n(a(this))),d(),e(a(this))}),a(".goodsInfo").on("click",".li06 .delete",function(i){t(),confirm("你确定要删除吗？")&&a(this).parents(".goodsInfo").remove(),s(a(this).parents(".goodsInfo").find("img").attr("sid"),o),d(),c()}),a(".total-content .deleteall").on("click",function(){confirm("你确定要删除全部选中商品吗？")&&a(".goodsInfo:visible").each(function(){a(this).find("input:checkbox").is(":checked")&&(a(this).remove(),s(a(this).find("img").attr("sid"),o))}),d(),c()})}(jQuery);